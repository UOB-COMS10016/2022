<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb">

<head>
<meta name="style" content="cs" />
<title>University of Bristol - Computer Science - COMS10016: Imperative and Functional Programming</title>
<link rel="stylesheet" type="text/css" href="corporate.css">
<link rel="stylesheet" type="text/css" href="uob.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/9.9.0/styles/xcode.min.css"/>
<script src="https://cdn.jsdelivr.net/highlight.js/9.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/highlight.js/9.9.0/languages/cpp.min.js"></script>
<script>
  addEventListener('load', start);
  function start() {
    var pres = document.querySelectorAll("pre");
    for (var i in pres) hljs.highlightBlock(pres[i]);
  }
</script>
<style>
  body { font-size: 120%; }
  pre, .indent { margin-left: 40px; }
  details[open] { background-color: #cfc; }
  body { counter-reset: step; }
  h2::before { counter-increment: step; content: "Step " counter(step) ": "; }
</style>
</head>
<body bgcolor="#EEEEFF" style="margin:0; padding:30px;">

<div align="center"><img src="win.jpg" width="100px"><br/>COMS10016 | Week 01 | Preparation<br/><h1>SYSTEM SETUP FOR WINDOWS 10</h1></div>

This is a brief tutorial on how to setup your personal Windows 10 64bit Home or Professional system to be ready for the COMS10016 unit. 
The below steps represent one out of many ways of setting up your Windows 10 system for the unit. Many of the steps can be shortened 
and they are outlined as is for clarity. Before you start make sure Windows 10 is up-to-date with respect to updates and features. 
It is your responsibility to keep your personal system and passwords safe.

<h2>CHECK SYSTEM COMPATIBILITY</h2>
<ul>
<li>Hold the Windows key down and simultaneously press "s" so that a search box appears.</li>
<li>Type "about" in the searchbox.</li>
<li>Left-click "About your PC" in the results and the system specifications window should open.</li>
<li>Your system is compatible only if:</li>
  <ul>
    <li>Your "System type" is "64-bit operating system, x64-based processor".</li>
    <li>Your system is not in S-Mode and your "Edition" is either "Windows 10 Home" or "Windows 10 Professional" without "S Mode". If you need to switch out of S-Mode, follow the instructions on the <a href="https://support.microsoft.com/en-gb/help/4456067/windows-10-switch-out-of-s-mode" target="_blank">Microsoft Support Page</a>.</li>
    <li>"Version" must be at least 2004, including 20H2, 20H2, 21H1, 21H2. Version 1909 and before are unsupported. If you are running Version 1909 or earlier, you must update your system by going to "Settings -> Update & Security -> Windows Update", then checking for updates and installing any that are available.</li>
  </ul>
</ul> 


<h2>ACTIVATE LINUX-SUBSYSTEM IN WINDOWS 10</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "powershell" in the search box</li> 
<li>right-click on "Windows PowerShell" in the results</li> 
<li>select "Run as administrator"</li> 
<li>click yes the consent prompt and an elevated PowerShell will open</li>
<li>type "Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux" and press enter</li>
<li>restart your computer if prompted... then Windows 10's Linux subsystem should be activated</li>
</ul>

<h3>ACTIVATE WSL2 (WINDOWS SUBSYSTEM FOR LINUX) IN WINDOWS 10</h3>

<h4>Pleasant path</h4>

This will only work if you have the KB5004296 update released in July 2021 https://devblogs.microsoft.com/commandline/install-wsl-with-a-single-command-now-available-in-windows-10-version-2004-and-higher/

<!-- TODO: Emphasise importance of fully updated system -->

Requirements:
- Fully updated Windows
- Powershell must be in 64-bit mode (check by running `[Environment]::Is64BitProcess`)
- Hyper-V compatible machine (it's been around since 2008, so every laptop should be)

<ul>
  <li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
  <li>type "powershell" in the search box</li> 
  <li>right-click on "Windows PowerShell" in the results</li> 
  <li>select "Run as administrator"</li> 
  <li>click yes the consent prompt and an elevated PowerShell will open</li>
  <li>type "wsl --install -d Ubuntu" and press enter</li>
  <li>restart your computer</li>
  <li>soon after your computer reboots, an Ubuntu window should open and complete the installation process. This may take a few minutes.</li>
  <li>you will then be prompted to enter a UNIX username and password. Make sure you remember them. You can use any username, but many people just use their name in lowercase (eg. "tilo").</li>
  <li>update Ubuntu by running "sudo apt update" (this checks for upgrades), then "sudo apt upgrade" (this installs the upgrades). When asked "Do you want to continue? [Y/n]", press enter to select the default "Y"/"Yes" option, and wait for the upgrade to complete.</li>
</ul>

<h2>INSTALL THE LINUX UBUNTU DISTRIBUTION</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "store" in the searchbox</li>
<li>left-click on "Microsoft Store" in the results and the Microsoft Store window will open</li>
<li>left-click on "Search" at the top right of the window and a search box will open</li>
<li>type "Ubuntu" and a red app symbol will appear in the list, left-click on the app called "Ubuntu"</li>
<li>left-click on "Get" the app and then "Install" and the installation will begin</li>
<li>after the installation left-click on "Launch" and a terminal window will open</li>
<li>after a while enter a UNIX username and press enter, then enter (and remember) a password and press enter</li>
<li>once ready, Ubuntu should now be installed</li>
<li>type "exit" and press enter to close the Linux terminal window</li>
</ul>

TODO: Add symlink instructions, eg. `~$ ln -s /mnt/c/Users/[username]/Documents WindowsDocuments`

<h2>INSTALL THE CLANG COMPILER</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "Ubuntu" in the searchbox</li>
<li>left-click on "Ubuntu" in the results and a Linux terminal window will open</li>
<li>type "sudo apt update", then press enter and the update process will begin</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>once ready, type "sudo apt install clang", then press enter and the installation will begin</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>once ready, the clang compiler should be installed</li>
<li>type "exit" and press enter to close the Linux terminal window</li>
</ul>

<h2>INSTALL THE VSCODE EDITOR</h2>
<ul>
<li>go to <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>
<li>download and run the installer for Windows</li>
<li>During installation, under the Additional Tasks step, ensure all the checkboxes under "Other:" are checked.</li>
<li>Once VSCode is installed, open it.</li>
<li>Install the "Remote - WSL" extension by pressing Ctrl + P and then entering "ext install ms-vscode-remote.remote-wsl".</li>
<li>Whenever using VSCode, make you're using a WSL window. The easiest way to do that is to look in the bottom right corner of the window. If it's using WSL, it will say "WSL: Ubuntu". If it doesn't, click it and select one of the commands to open a WSL Window, e.g. "New WSL Window" or "Reopen Folder in WSL" if you have a folder open already. (TODO: Come back to this and make it as straight forward as possible, maybe add pictures)</li>
<li>Make sure you have a VSCode WSL window open and install the "Haskell" extension by pressing Ctrl + P and then entering "ext install haskell.haskell".</li>
<li>Test this is working by creating a new Haskell file named "test.hs" (e.g. with "File -> New File" and naming it "test.hs"). This should give you a prompt saying "How do you want the extension to manage/discover HLS and the relevant toolchain?". Select "Automatically via GHCup".</li>
<li>If it says "Need to download stack, continue?", you can safely select either "Yes" or "No". Either way, we will not be using stack.</li>
<li>In "test.hs", start typing some invalid Haskell code, e.g. "x = True && 'c'". If HLS is working, you should see that VSCode underlines the error.</li>
</ul>

<h2>INSTALL HASKELL AND QUICKCHECK</h2>
TODO: Do this before VSCode, then add HLS stuff to VSCode instructions

<ul>
<li>In the Ubuntu terminal, first install the dependencies for GHCup by running "sudo apt install build-essential libgmp-dev libncurses-dev libncurses5 libtinfo5" </li>

<li>In the Ubuntu terminal, run "curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh"</li>

<li>Press enter to proceed</li>
<li>When asked about adding the required PATH variable to .bashrc, select "Yes, prepend" by typing "P" and pressing enter.</li>
<li>When asked about installing haskell-language-server, select "Yes" by entering "Y".</li>
<li>When asked about installing stack, select "No" by entering "N".</li>
<li>Press enter to proceed and wait for the installation to finish.</li>
<li>This will install "ghc" (the Haskell compiler), "ghci" (the Haskell <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a>), "cabal" (a Haskell package manager), and the Haskell Language Server (a.k.a. HLS, which adds <a href="https://en.wikipedia.org/wiki/Integrated_development_environment">IDE</a> support for Haskell)</li>
<li>Close and reopen your Ubuntu terminal so the updated PATH variable in .bashrc can take effect, giving you access to the programs you just installed.</li>
<li>Check they're working by running "ghc --version", "cabal --version", and "haskell-language-server-wrapper --version". If they've installed correctly, these commands should print out the version information.</li>
<li>Install QuickCheck by running "cabal install --lib QuickCheck"</li>

<li>Note: if you have any further installation issues, the Teaching Assistants (TAs) will be there in the first lab to help you with this in the setup labs.</li>
<hr/>
<li>after a successful installation, you can run the Haskell GHCi interpreter by typing "stack ghci" in the terminal and pressing enter</li>
<li>after a successful installation, you can run the Haskell GHCi interpreter with the QuickCheck package by typing "stack ghci --package QuickCheck" in the terminal and pressing enter</li>
<li>after a successful installation, you can interpret Haskell files (such as a file "File.hs") by adding the file as a final argument to your stack command like "stack ghci --package QuickCheck File.hs" in the terminal and pressing enter</li>
<li>after a successful installation, you can compile Haskell files (such as a file "File.hs") by adding the file as a final argument to your stack command like "stack ghc --package QuickCheck File.hs" in the terminal and pressing enter</li>
<hr/>
<li>Note: once you verify that GHCi is running, you can use the :q command to exit it and go back to the command prompt.</li>
<hr/>
<b>IMPORTANT NOTE:</b> If the Haskell installation does not work for you then hold on and use the setup labs during week 1 to get help from a TA. 
Only if after asking TAs for help you have not been able to install Haskell successfully, then consider looking into more complicated <a href="haskellextra.html" target="_blank">alternatives</a>.
</ul>

At this point your system is ready for most of the COMS10016 unit and you are ready to start programming in C and Haskell. Further installations
are optional at the beginning of the unit. However, during the last part of the unit we will use graphics, and for this we will need the SDL2 graphics libraries 
and a Linux desktop environment...

<h2>INSTALL THE SDL2 DEVELOPMENT PACKAGE</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "Ubuntu" in the searchbox</li>
<li>left-click on "Ubuntu" in the results and a Linux terminal window will open</li>
<li>type "sudo apt update", then press enter and the update process will begin</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>once ready, type "sudo apt install libsdl2-dev", then press enter and the installation will begin</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>once ready, the SDL2 library should be installed</li>
<li>type "exit" and press enter to close the Linux terminal window</li>
</ul>

<h2>INSTALL THE VCXSRV WINDOWS X-SERVER</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "edge" in the search box</li>
<li>left-click on "Microsoft Edge" in the results and a browser window will open</li>
<li>type "sourceforge.net/projects/vcxsrv/files/latest/download" in the browser bar, then press enter</li> 
<li>left-click on "Run" when asked so the download and setup starts</li>
<li>in case your windows administrator password is required provide it and press enter to confirm</li>
<li>the installation window will open, left-click on the "Next" button, then "Install" and finally "Close"</li>  
<li>the windows x-server should now be installed</li>
</ul>

<h2>INSTALL THE LXDE LINUX DESKTOP</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "Ubuntu" in the searchbox</li>
<li>left-click on "Ubuntu" in the results and a Linux terminal window will open</li>
<li>type "sudo apt upgrade", then press enter, enter your password, press enter again and the upgrade process will begin</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>during the installation select "YES" for restarting services without further queries</li>
<li>once ready, type "sudo apt install lxde" in your terminal, then press enter and the installation will start</li>
<li>in case you are queried about disk usage during the installation type "Y" and press enter to confirm</li>
<li>If asked which display manager to use, select "lightdm"</li>
<li>after some significant installation time, once ready, the LXDE Linux desktop should be installed</li>
<li>type "exit" and press enter to close the Linux terminal window</li>
</ul>

<h2>RUNNING THE LINUX DESKTOP AND CHECKING SDL2</h2>
<ul>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "xlaunch" in the searchbox</li>
<li>left-click on "XLaunch" in the results and a display settings window will open</li>
<li>select "One large window" and left-click "Next"</li>
<li>select "Start no client" and left-click "Next"</li>
<li>make sure "Clipboard", "Primary Selection", "Native opengl", and "Disable access control" are ticked, then left-click "Next"</li>
<li>left-click "Finish" and a black VcXsrv window will open</li>
<li>If you get a security alert saying "Windows Defender Firewall has blocked some features of VcXsrv windows xserver on all public and private networks", under "Allow VcXsrv windows xserver to communicate on these networks:", make sure "Private networks" and "Public networks" are checked, then click "Allow access". Ideally this wouldn't be necessary, but it's been an <a href="https://github.com/microsoft/WSL/issues/4139">open issue since 2019</a>.</li>
<li>hold the Windows key down and simultaneously press "s" so that a search box appears</li>
<li>type "Ubuntu" in the searchbox</li>
<li>left-click on "Ubuntu" in the results and a Linux terminal window will open</li>
<li>type "export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0" and press enter</li>
<li>type "export LIBGL_ALWAYS_INDIRECT=1" and press enter</li> (TODO: Maybe add these to .bashrc for simplicity...)
<li>type "startlxde" and press enter</li>
<li>the Linux desktop should appear in the VcXsrv window</li>
<li>open a terminal on the Linux desktop by going to "System Tools" and selecting "LXTerminal"</li>
<li>download the program <a href="hellosdl.c" target="_blank">hellosdl.c</a> and copy it into a new folder (TODO: expand on this/make it easier)</li>
<li>change directory to that new folder where the downloaded file is located (just as an example in the Ubuntu terminal you find your D:/ drive via "cd /mnt/d")
<li>avoid using the top directory of your C: drive since it is write-protected by the operating system
<li>compile the program in that folder with "clang -std=c11 -Wall hellosdl.c -I /usr/include/SDL2 -l SDL2 -o hellosdl", where the 'I' (uppercase i) in "-I /usr/include/SDL2" stands for "include" and the 'l' (lowercase L) in "-l SDL2" stands for 'link'</li>
<li>run the program, for instance via "./hellosdl" - if you see a sky blue window appear then SDL2 is working properly</li>
<li>note that some parts of the SDL library unfortunately have memory leaks, which may be reported back to the terminal...you have to live with it</li>
</ul>
</body>
</html>
